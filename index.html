<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Interactive BDI-II Questionnaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Add Font Awesome for social media icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Add html2canvas for JPG export -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #e8f8f0; /* Light green-tinted background */
            transition: background-color 0.3s ease;
        }
        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }
        .logo {
            height: 4rem;
            filter: drop-shadow(0 2px 4px rgba(13, 50, 66, 0.1));
            transition: transform 0.3s ease;
        }
        .logo:hover {
            transform: scale(1.05);
        }
        .content-card {
            background-color: white;
            border-radius: 0.75rem; 
            box-shadow: 0 4px 6px -1px rgba(13, 50, 66, 0.15), 0 2px 4px -1px rgba(13, 50, 66, 0.1);
            margin-bottom: 1.5rem; 
            padding: 1.5rem; 
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .content-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(13, 50, 66, 0.15), 0 4px 6px -2px rgba(13, 50, 66, 0.1);
        }
        .section-title {
            font-size: 1.25rem; 
            font-weight: 600; 
            color: #00be61; 
            margin-bottom: 1rem; 
        }
        .section-title.results-title {
            color: #0d3242;
            font-size: 1.75rem;
        }
        .statement-label {
            display: flex;
            align-items: center;
            padding: 0.85rem 1rem; 
            margin-bottom: 0.65rem; 
            border: 1px solid #e2e8f0; 
            border-radius: 0.5rem; 
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out, transform 0.1s ease-in-out;
            color: #0d3242;
        }
        .statement-label:hover {
            background-color: rgba(0, 190, 97, 0.05); 
            border-color: #00be61; 
            transform: translateX(2px);
        }
        .statement-label input[type="radio"] {
            margin-right: 0.85rem; 
            accent-color: #00be61; 
            width: 1.15em; 
            height: 1.15em;
        }
        .statement-label:has(input[type="radio"]:checked) {
            background-color: rgba(0, 190, 97, 0.1); 
            border-color: #00be61; 
            font-weight: 500;
        }
        .app-button { 
            background-color: #00be61; 
            color: white;
            font-weight: 600; 
            padding: 0.75rem 1.5rem; 
            border-radius: 0.5rem; 
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        .app-button::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }
        .app-button:hover {
            background-color: #009e51; 
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 190, 97, 0.2);
        }
        .app-button:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }
        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.3;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }
        .app-button:disabled {
            background-color: rgba(0, 190, 97, 0.5); 
            cursor: not-allowed;
            transform: none;
        }
        .app-button.secondary {
            background-color: #0d3242; 
            color: white;
        }
        .app-button.secondary:hover {
            background-color: #0a2532; 
            box-shadow: 0 5px 15px rgba(13, 50, 66, 0.2);
        }
        .app-button.tertiary {
            background-color: transparent;
            color: #0d3242;
            border: 1px solid #0d3242;
        }
        .app-button.tertiary:hover {
            background-color: rgba(13, 50, 66, 0.05);
            box-shadow: 0 2px 8px rgba(13, 50, 66, 0.1);
        }
        .app-button i {
            margin-right: 0.5rem;
        }

        .results-card {
            background-color: #e8f8f0; 
            border: 1px solid #b8ecd5; 
            color: #0d3242; 
        }
        .score-display-area .score-value { /* Target score-value within this area */
            font-size: 1.75rem; /* text-3xl, adjusted for "X out of Y" */
            font-weight: 700; 
            color: #0d3242; 
            margin-bottom: 0.25rem; /* Space before interpretation */
        }
        .score-display-area .interpretation-text { /* Target interpretation-text within this area */
            font-size: 1.125rem; /* text-lg */
            font-weight: 500;
            background-color: rgba(13, 50, 66, 0.1);
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        .progress-bar-container {
            width: 100%;
            background-color: rgba(13, 50, 66, 0.1); 
            border-radius: 0.5rem; 
            overflow: hidden;
            height: 1.25rem; 
            margin-bottom: 1.5rem;
        }
        .progress-bar-fill {
            background-color: #00be61; 
            height: 100%;
            width: 0%;
            border-radius: 0.5rem; 
            transition: width 0.3s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem; 
        }
        .level-indicator-container { margin-top: 1.5rem; }
        .level-bar-wrapper { display: flex; align-items: center; margin-bottom: 0.75rem; }
        .level-label { width: 130px; font-size: 0.875rem; color: #0d3242; text-align: right; padding-right: 0.75rem; }
        .level-bar { flex-grow: 1; height: 1.5rem; background-color: rgba(13, 50, 66, 0.1); border-radius: 0.25rem; overflow: hidden; position: relative; }
        .level-fill { 
            height: 100%; 
            transition: width 0.5s ease; 
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            text-shadow: 0 1px 1px rgba(0,0,0,0.2);
        }
        .level-minimal { background-color: #00be61; } /* Keep the main green */
        .level-mild { background-color: #4c9aff; } /* Blue */
        .level-borderline { background-color: #ffaa42; } /* Orange */
        .level-moderate { background-color: #a065ff; } /* Purple */
        .level-severe { background-color: #ff5e6d; } /* Red */
        
        .your-score-marker-container { /* New container for marker and text */
            position: absolute;
            top: 50%;
            left: 0%; /* Will be set by JS */
            transform: translateY(-50%);
            transition: left 0.5s ease;
            z-index: 10;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .your-score-marker {
            height: 1.5rem; 
            width: 4px;
            background-color: #0d3242; 
            border-radius: 2px;
        }
        .your-score-text {
            font-size: 0.75rem; /* text-xs */
            font-weight: 600;
            color: #0d3242;
            background-color: rgba(255, 255, 255, 0.8);
            padding: 1px 4px;
            border-radius: 3px;
            margin-top: -22px; /* Position above the marker line */
            white-space: nowrap;
        }

        .question-counter {
            font-size: 0.875rem; 
            color: #0d3242; 
            text-align: center;
            margin-bottom: 1rem;
        }
        .hidden-view { display: none; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }

        /* Table styling for results */
        .results-table {
            width: 100%;
            margin-top: 1.5rem;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        .results-table th, .results-table td {
            border: 1px solid #b8ecd5; /* Green-tinted border */
            padding: 0.75rem;
            text-align: left;
        }
        .results-table th {
            background-color: #0d3242; /* Dark blue header */
            color: white; /* White text for contrast */
            font-weight: 600;
        }
        .results-table td {
            background-color: #e8f8f0; /* Light green background */
        }
        .footer-logo {
            height: 2rem;
            margin-top: 0.5rem;
            filter: drop-shadow(0 1px 2px rgba(13, 50, 66, 0.1));
        }
        
        /* New styles for BDI-II info card */
        .bdi-info-card {
            background-color: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .bdi-info-card h3 {
            color: #0369a1;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .bdi-info-card h3 i {
            margin-right: 0.5rem;
        }
        
        .bdi-info-content {
            font-size: 0.875rem;
            color: #0c4a6e;
        }
        
        /* Styles for share buttons */
        .share-container {
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .share-title {
            font-size: 1rem;
            font-weight: 600;
            color: #0d3242;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
        }
        
        .share-title i {
            margin-right: 0.5rem;
        }
        
        .share-buttons {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .share-button {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .share-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
        }
        
        .share-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .share-button:hover::before {
            transform: translateY(0);
        }
        
        .share-button i {
            position: relative;
            z-index: 2;
        }
        
        .share-facebook {
            background-color: #1877f2;
        }
        
        .share-twitter {
            background-color: #1da1f2;
        }
        
        .share-linkedin {
            background-color: #0077b5;
        }
        
        .share-whatsapp {
            background-color: #25d366;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .download-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: #0d3242;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .download-button:hover {
            background-color: #0a2532;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(13, 50, 66, 0.2);
        }
        
        /* Toast notification for download success */
        .toast-notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            background-color: #00be61;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 100;
        }
        
        .toast-notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* Modal for image preview */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            position: relative;
            transform: scale(0.9);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        
        .modal-overlay.show .modal-content {
            transform: scale(1);
            opacity: 1;
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #0d3242;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .modal-close:hover {
            color: #ff5e6d;
        }
        
        .result-image-container {
            text-align: center;
        }
        
        .result-image {
            max-width: 100%;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 1.5rem;
            height: 1.5rem;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Results card for capture */
        #resultsCapture {
            background: #e8f8f0 !important;
            border-radius: 18px;
            padding: 2.5rem 1.5rem 2rem 1.5rem;
            max-width: 520px;
            margin: 0 auto;
            box-shadow: 0 2px 16px rgba(13, 50, 66, 0.10);
            border: none;
        }
        
        .capture-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .capture-title {
            font-size: 2.1rem;
            font-weight: 700;
            color: #0d3242;
            margin-bottom: 0.2rem;
        }
        
        .capture-subtitle {
            font-size: 1rem;
            color: #00be61;
            margin-bottom: 0.5rem;
        }
        
        .capture-score-interpretation-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-bottom: 1.5rem;
        }
        
        .capture-score-value {
            font-size: 2rem;
            font-weight: 700;
            color: #0d3242;
            text-align: center;
            margin-bottom: 1.1rem;
        }
        
        .capture-interpretation {
            font-size: 1.1rem;
            font-weight: 600;
            background: #d1fae5;
            color: #059669;
            border-radius: 10px;
            padding: 0.85rem 1rem;
            margin-bottom: 0.5rem;
            text-align: center;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .capture-chart-card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(13, 50, 66, 0.08);
            padding: 1.2rem 1rem 1.5rem 1rem;
            margin: 0 auto 1.5rem auto;
            max-width: 98%;
        }
        
        .capture-chart-card .chart-title {
            font-weight: 700;
            color: #0d3242;
            margin-bottom: 1.1rem;
            font-size: 1.1rem;
            text-align: center;
        }
        
        .capture-footer {
            text-align: center;
            font-size: 0.85rem;
            color: #0d3242;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }
        
        .capture-logo {
            height: 1.5rem;
            margin-top: 0.5rem;
        }
        
        /* Back button */
        .back-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            color: #0d3242;
            font-weight: 500;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        
        .back-button:hover {
            color: #00be61;
        }
        
        .back-button i {
            font-size: 1.25rem;
        }

        /* Question category styling */
        .symptom-category {
            font-size: 1.4rem;
            font-weight: 700;
            color: #0d3242;
            margin-bottom: 0.5rem;
        }

        .category-name {
            color: #00be61;
            font-weight: 700;
        }

        .question-instruction {
            font-size: 0.95rem;
            color: #4b5563;
            margin-bottom: 1.25rem;
            font-style: italic;
        }

        /* Modernized chart styling - enhanced for better visualization */
        .modern-chart-container {
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background-color: #f8f9fa;
            border-radius: 0.75rem;
            box-shadow: 0 2px 10px rgba(13, 50, 66, 0.1);
        }

        .chart-title {
            font-weight: 600;
            color: #0d3242;
            margin-bottom: 1.25rem;
            font-size: 1rem;
            text-align: center;
        }

        /* Column chart styling */
        .column-chart {
            display: flex;
            height: 200px;
            align-items: flex-end;
            justify-content: space-around;
            margin: 0 10px;
            position: relative;
        }

        .column {
            width: 22%;
            position: relative;
            border-radius: 6px 6px 0 0;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
        }

        .column:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .column-label {
            position: absolute;
            bottom: -25px;
            text-align: center;
            width: 100%;
            font-weight: 600;
            font-size: 0.8rem;
            color: #333;
        }

        .column-value {
            position: absolute;
            top: -25px;
            text-align: center;
            width: 100%;
            font-weight: 600;
            font-size: 0.8rem;
            color: #333;
        }

        .column-minimal {
            background-color: #00be61;
        }

        .column-mild {
            background-color: #4c9aff;
        }

        .column-moderate {
            background-color: #ffaa42;
        }

        .column-severe {
            background-color: #ff5e6d;
        }

        .your-score-marker {
            position: absolute;
            height: 100%;
            width: 3px;
            background-color: #0d3242;
            z-index: 10;
            transition: all 0.3s ease;
        }

        .your-score-label {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #0d3242;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.85rem;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .your-score-label::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #0d3242 transparent transparent transparent;
        }

        .score-axis {
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background-color: #ccc;
            bottom: 0;
        }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .app-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .toast-notification {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%) translateY(100%);
            background-color: #00be61;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            z-index: 100;
        }

        .toast-notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        @media (max-width: 640px) {
            .column {
                width: 20%;
            }
            
            .column-label {
                font-size: 0.7rem;
            }
            
            .column-value {
                font-size: 0.7rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons button {
                width: 100%;
            }
            
            .modern-chart-container {
                padding: 1rem 0.5rem;
            }
            
            .column-chart {
                height: 150px;
            }
        }

        /* Add this to the <style> section */
        .capture-score-interpretation-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .capture-score-value, .capture-interpretation {
            width: 100%;
            max-width: 420px;
            box-sizing: border-box;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
</head>
<body class="antialiased text-gray-800 min-h-screen flex flex-col items-center p-4 sm:p-6">

    <div class="w-full max-w-2xl mx-auto">
        <header class="my-6 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-[#0d3242]">Interactive BDI-II</h1>
            <p class="mt-1 text-sm text-[#00be61]">Beck Depression Inventory - II</p>
        </header>

        <div id="progressBarContainer" class="progress-bar-container hidden-view">
            <div id="progressBarFill" class="progress-bar-fill">0%</div>
        </div>
        <div id="questionCounter" class="question-counter hidden-view"></div>

        <div id="introView" class="content-card fade-in">
            <h2 class="section-title text-xl">Welcome & Instructions</h2>
            <p class="text-[#0d3242] leading-relaxed mb-3">
                This questionnaire consists of 21 groups of statements. Please read each group of statements carefully.
                Then pick out the <strong>one statement</strong> in each group that best describes the way you have been
                feeling during the <strong>past two weeks, including today</strong>.
            </p>
            <p class="text-[#0d3242] leading-relaxed mb-4">
                If several statements in the group seem to apply equally well, choose the one with the highest number for that group.
                Be sure that you do not choose more than one statement for any group.
            </p>
            <div class="p-3 mb-4 bg-[#e8f8f0] border border-[#b8ecd5] rounded-md">
                <h3 class="text-md font-semibold text-[#0d3242] mb-1">Important Disclaimer</h3>
                <p class="text-xs text-[#0d3242] leading-relaxed">
                    This is an interactive version of the BDI-II for informational and illustrative purposes only.
                    It is <strong>NOT</strong> a substitute for professional medical advice, diagnosis, or treatment.
                    Always seek the advice of your physician or other qualified health provider with any questions you may have regarding a medical condition.
                    If you are in crisis, please contact emergency services or a crisis hotline.
                </p>
            </div>
            <div class="flex justify-center">
                <button id="startButton" class="app-button"><i class="fas fa-play"></i> Start Assessment</button>
            </div>
        </div>

        <div id="questionsView" class="hidden-view">
            <div id="questionContent" class="content-card">
                </div>
            <div id="validationMessage" class="mt-3 mb-2 p-3 bg-red-100 border border-red-300 text-red-700 rounded-md text-sm hidden-view"></div>
            <div class="mt-6 flex justify-between items-center">
                <button id="prevButton" class="app-button secondary"><i class="fas fa-chevron-left"></i> Previous</button>
                <button id="nextButton" class="app-button">Next <i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <div id="resultsView" class="content-card results-card hidden-view">
            <div class="back-button" id="backToQuestions">
                <i class="fas fa-arrow-left"></i> Back to Questions
            </div>
            
            <div class="text-center mb-4 score-display-area">
                <p id="scoreValue" class="score-value">Your Score: 0 out of 63</p>
                <p id="scoreInterpretation" class="interpretation-text"></p>
            </div>

            <!-- New Column Chart for Score Interpretation -->
            <div class="modern-chart-container">
                <div class="chart-title">Score Interpretation</div>
                <div id="columnChart" class="column-chart">
                    <!-- Will be filled by JavaScript -->
                    <div class="score-axis"></div>
                </div>
            </div>

            <table class="results-table">
                <thead>
                    <tr>
                        <th>Total Score</th>
                        <th>Level of Depression</th>
                    </tr>
                </thead>
                <tbody id="interpretationTableBody">
                    <!-- Will be filled by JavaScript -->
                </tbody>
            </table>

            <!-- New BDI-II Information Section -->
            <div class="bdi-info-card">
                <h3><i class="fas fa-info-circle"></i> About the BDI-II</h3>
                <div class="bdi-info-content">
                    <p>The Beck Depression Inventory-II (BDI-II) is a widely used 21-item self-report inventory measuring the severity of depression in adolescents and adults. Developed by Dr. Aaron T. Beck and colleagues, it assesses symptoms corresponding to criteria for diagnosing depressive disorders listed in the DSM-IV. The BDI-II is designed to identify the presence and severity of symptoms consistent with depression, not to formulate a clinical diagnosis.</p>
                </div>
            </div>

            <!-- Share and Download Section - updated as requested -->
            <div class="share-container">
                <div class="action-buttons">
                    <button id="generateImageBtn" class="app-button">
                        <i class="fas fa-download"></i> Download Result
                    </button>
                    <button id="copyLinkBtn" class="app-button tertiary">
                        <i class="fas fa-link"></i> Copy Test Link
                    </button>
                    <button id="restartButton" class="app-button secondary">
                        <i class="fas fa-redo"></i> Take Again
                    </button>
                </div>
            </div>

            <p class="mt-6 text-xs text-[#0d3242] text-center">
                <strong>Note:</strong> These score ranges are typical, but interpretations may vary. This tool does not provide a diagnosis.
                If you have concerns about your mood or mental health, please consult a healthcare professional.
            </p>
        </div>

        <!-- Hidden div for image capture -->
        <div id="resultsCapture" class="hidden-view">
            <div class="capture-header">
                <div class="capture-title">BDI-II Assessment Results</div>
                <div class="capture-subtitle">Beck Depression Inventory - II</div>
            </div>
            <div class="capture-score-interpretation-wrapper">
                <div id="captureScoreValue" class="capture-score-value">Your Score: 0 out of 63</div>
                <div id="captureInterpretation" class="capture-interpretation">Interpretation text will appear here.</div>
            </div>
            <div class="capture-chart-card" id="captureChartCard">
                <div class="chart-title">Score Interpretation</div>
                <div id="captureScoreLevels"></div>
            </div>
            <div class="capture-footer">
                <p>Assessment completed on <span id="captureDate"></span></p>
                <p>This is for informational purposes only and not a clinical diagnosis.</p>
                <div class="flex justify-center mt-2">
                    <img src="https://raw.githubusercontent.com/PsychTalks/assets/363231be8d929887eb25f9b811981a44110a4088/Asset%201gg.png" alt="PsychTalks Logo" class="capture-logo">
                </div>
            </div>
        </div>

        <!-- Modal for image preview -->
        <div id="imageModal" class="modal-overlay">
            <div class="modal-content">
                <button id="modalClose" class="modal-close">&times;</button>
                <div class="result-image-container">
                    <img id="resultImage" class="result-image" src="" alt="Your BDI-II Results">
                </div>
                <div class="modal-actions">
                    <button id="downloadImageBtn" class="app-button">
                        <i class="fas fa-download"></i> Download Image
                    </button>
                    <button id="shareImageBtn" class="app-button secondary">
                        <i class="fas fa-share-alt"></i> Share Image
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast notification for actions -->
        <div id="toastNotification" class="toast-notification">
            Action completed successfully!
        </div>

        <footer class="mt-10 mb-6 text-center text-xs text-[#0d3242]">
            <p>BDI-II content based on the Beck Depression Inventory, Second Edition. Copyright © 1996 by Aaron T. Beck. All rights reserved.</p>
            <p class="mb-2">This interactive tool is for educational purposes only.</p>
            <p class="text-sm font-medium">Presented to you by <span class="text-[#00be61]">PsychTalks</span></p>
            <div class="flex justify-center mt-2">
                <img src="https://raw.githubusercontent.com/PsychTalks/assets/363231be8d929887eb25f9b811981a44110a4088/Asset%201gg.png" alt="PsychTalks Logo" class="footer-logo">
            </div>
        </footer>
    </div>

    <script>
        // --- Configuration & Data ---
        const questions = [
            { id: 1, category: "Sadness", category_bn: "দুঃখ", title: "Have you felt sad during the past two weeks, including today?", statements: [ { text: "I do not feel sad.", score: 0 }, { text: "I feel sad much of the time.", score: 1 }, { text: "I am sad all the time.", score: 2 }, { text: "I am so sad or unhappy that I can't stand it.", score: 3 } ] }, 
            { id: 2, category: "Pessimism", category_bn: "নিরাশা", title: "Have you experienced pessimistic thoughts during the past two weeks, including today?", statements: [ { text: "I am not discouraged about my future.", score: 0 }, { text: "I feel more discouraged about my future than I used to.", score: 1 }, { text: "I do not expect things to work out for me.", score: 2 }, { text: "I feel my future is hopeless and will only get worse.", score: 3 } ] }, 
            { id: 3, category: "Past Failure", category_bn: "ব্যর্থতা", title: "Have you felt like a failure during the past two weeks, including today?", statements: [ { text: "I do not feel like a failure.", score: 0 }, { text: "I have failed more than I should have.", score: 1 }, { text: "As I look back, I see a lot of failures.", score: 2 }, { text: "I feel I am a total failure as a person.", score: 3 } ] }, 
            { id: 4, category: "Loss of Pleasure", category_bn: "আনন্দহীনতা", title: "Have you lost interest or pleasure in things during the past two weeks, including today?", statements: [ { text: "I get as much pleasure as I ever did from the things I enjoy.", score: 0 }, { text: "I don't enjoy things as much as I used to.", score: 1 }, { text: "I get very little pleasure from the things I used to enjoy.", score: 2 }, { text: "I can't get any pleasure from the things I used to enjoy.", score: 3 } ] }, 
            { id: 5, category: "Guilty Feelings", category_bn: "অপরাধবোধ", title: "Have you felt guilty during the past two weeks, including today?", statements: [ { text: "I don't feel particularly guilty.", score: 0 }, { text: "I feel guilty over many things I have done or should have done.", score: 1 }, { text: "I feel quite guilty most of the time.", score: 2 }, { text: "I feel guilty all of the time.", score: 3 } ] }, 
            { id: 6, category: "Punishment Feelings", category_bn: "শাস্তিপ্রাপ্তি", title: "Have you felt punished or that you deserve to be punished during the past two weeks, including today?", statements: [ { text: "I don't feel I am being punished.", score: 0 }, { text: "I feel I may be punished.", score: 1 }, { text: "I expect to be punished.", score: 2 }, { text: "I feel I am being punished.", score: 3 } ] }, 
            { id: 7, category: "Self-Dislike", category_bn: "নিজেকে অপছন্দ", title: "Have you disliked yourself during the past two weeks, including today?", statements: [ { text: "I feel the same about myself as ever.", score: 0 }, { text: "I have lost confidence in myself.", score: 1 }, { text: "I am disappointed in myself.", score: 2 }, { text: "I dislike myself.", score: 3 } ] }, 
            { id: 8, category: "Self-Criticalness", category_bn: "নিজেকে সমালোচনা", title: "Have you been self-critical during the past two weeks, including today?", statements: [ { text: "I don't criticize or blame myself more than usual.", score: 0 }, { text: "I am more critical of myself than I used to be.", score: 1 }, { text: "I criticize myself for all of my faults.", score: 2 }, { text: "I blame myself for everything bad that happens.", score: 3 } ] }, 
            { id: 9, category: "Suicidal Thoughts", category_bn: "আত্মহত্যাচিন্তা", title: "Have you had thoughts or wishes about hurting yourself during the past two weeks, including today?", statements: [ { text: "I don't have any thoughts of killing myself.", score: 0 }, { text: "I have thoughts of killing myself, but I would not carry them out.", score: 1 }, { text: "I would like to kill myself.", score: 2 }, { text: "I would kill myself if I had the chance.", score: 3 } ] }, 
            { id: 10, category: "Crying", category_bn: "অতিরিক্ত কান্না", title: "Have you cried more than usual during the past two weeks, including today?", statements: [ { text: "I don't cry anymore than I used to.", score: 0 }, { text: "I cry more than I used to.", score: 1 }, { text: "I cry over every little thing.", score: 2 }, { text: "I feel like crying, but I can't.", score: 3 } ] }, 
            { id: 11, category: "Agitation", category_bn: "অস্থিরতা", title: "Have you felt restless or agitated during the past two weeks, including today?", statements: [ { text: "I am no more restless or wound up than usual.", score: 0 }, { text: "I feel more restless or wound up than usual.", score: 1 }, { text: "I am so restless or agitated, it's hard to stay still.", score: 2 }, { text: "I am so restless or agitated that I have to keep moving or doing something.", score: 3 } ] }, 
            { id: 12, category: "Loss of Interest", category_bn: "আগ্রহ হারানো", title: "Have you lost interest in activities during the past two weeks, including today?", statements: [ { text: "I have not lost interest in other people or activities.", score: 0 }, { text: "I am less interested in other people or things than before.", score: 1 }, { text: "I have lost most of my interest in other people or things.", score: 2 }, { text: "It's hard to get interested in anything.", score: 3 } ] }, 
            { id: 13, category: "Indecisiveness", category_bn: "সিদ্ধান্তহীনতা", title: "Have you had difficulty making decisions during the past two weeks, including today?", statements: [ { text: "I make decisions about as well as ever.", score: 0 }, { text: "I find it more difficult to make decisions than usual.", score: 1 }, { text: "I have much greater difficulty in making decisions than I used to.", score: 2 }, { text: "I have trouble making any decisions.", score: 3 } ] }, 
            { id: 14, category: "Worthlessness", category_bn: "মূল্যহীনতা", title: "Have you felt worthless during the past two weeks, including today?", statements: [ { text: "I do not feel I am worthless.", score: 0 }, { text: "I don't consider myself as worthwhile and useful as I used to.", score: 1 }, { text: "I feel more worthless as compared to others.", score: 2 }, { text: "I feel utterly worthless.", score: 3 } ] }, 
            { id: 15, category: "Loss of Energy", category_bn: "শক্তিহীনতা", title: "Have you experienced a loss of energy during the past two weeks, including today?", statements: [ { text: "I have as much energy as ever.", score: 0 }, { text: "I have less energy than I used to have.", score: 1 }, { text: "I don't have enough energy to do very much.", score: 2 }, { text: "I don't have enough energy to do anything.", score: 3 } ] }, 
            { id: 16, category: "Changes in Sleeping Pattern", category_bn: "ঘুমের পরিবর্তন", title: "Have you noticed changes in your sleeping patterns during the past two weeks, including today?", statements: [ { text: "I have not experienced any change in my sleeping.", score: 0 }, { text: "I sleep somewhat more than usual. (1a)", score: 1 }, { text: "I sleep somewhat less than usual. (1b)", score: 1 }, { text: "I sleep a lot more than usual. (2a)", score: 2 }, { text: "I sleep a lot less than usual. (2b)", score: 2 }, { text: "I sleep most of the day. (3a)", score: 3 }, { text: "I wake up 1-2 hours early and can't get back to sleep. (3b)", score: 3 } ] }, 
            { id: 17, category: "Irritability", category_bn: "রাগ", title: "Have you felt irritable during the past two weeks, including today?", statements: [ { text: "I am no more irritable than usual.", score: 0 }, { text: "I am more irritable than usual.", score: 1 }, { text: "I am much more irritable than usual.", score: 2 }, { text: "I am irritable all the time.", score: 3 } ] }, 
            { id: 18, category: "Changes in Appetite", category_bn: "ক্ষুধার পরিবর্তন", title: "Have you noticed changes in your appetite during the past two weeks, including today?", statements: [ { text: "I have not experienced any change in my appetite.", score: 0 }, { text: "My appetite is somewhat less than usual. (1a)", score: 1 }, { text: "My appetite is somewhat greater than usual. (1b)", score: 1 }, { text: "My appetite is much less than before. (2a)", score: 2 }, { text: "My appetite is much greater than usual. (2b)", score: 2 }, { text: "I have no appetite at all. (3a)", score: 3 }, { text: "I crave food all the time. (3b)", score: 3 } ] }, 
            { id: 19, category: "Concentration Difficulty", category_bn: "মনোযোগহীনতা", title: "Have you had trouble concentrating during the past two weeks, including today?", statements: [ { text: "I can concentrate as well as ever.", score: 0 }, { text: "I can't concentrate as well as usual.", score: 1 }, { text: "It's hard to keep my mind on anything for very long.", score: 2 }, { text: "I find I can't concentrate on anything.", score: 3 } ] }, 
            { id: 20, category: "Tiredness or Fatigue", category_bn: "ক্লান্তি", title: "Have you felt tired or fatigued during the past two weeks, including today?", statements: [ { text: "I am no more tired or fatigued than usual.", score: 0 }, { text: "I get more tired or fatigued more easily than usual.", score: 1 }, { text: "I am too tired or fatigued to do a lot of the things I used to do.", score: 2 }, { text: "I am too tired or fatigued to do most of the things I used to do.", score: 3 } ] }, 
            { id: 21, category: "Loss of Interest in Sex", category_bn: "যৌন আগ্রহহীনতা", title: "Have you lost interest in sex during the past two weeks, including today?", statements: [ { text: "I have not noticed any recent change in my interest in sex.", score: 0 }, { text: "I am less interested in sex than I used to be.", score: 1 }, { text: "I am much less interested in sex now.", score: 2 }, { text: "I have lost interest in sex completely.", score: 3 } ] }
        ];

        const scoreInterpretations = [
            { range: [0, 13], label: "Minimal depression", interpretation: "These ups and downs are considered normal.", class: "level-minimal" },
            { range: [14, 19], label: "Mild depression", interpretation: "Mild mood disturbance.", class: "level-mild" },
            { range: [20, 28], label: "Moderate depression", interpretation: "Borderline to moderate clinical depression.", class: "level-borderline" },
            { range: [29, 63], label: "Severe depression", interpretation: "Moderate to severe depression.", class: "level-severe" }
        ];
        const scoreLevelVisuals = [
            { label: "Minimal", maxScore: 13, class: "level-minimal" }, { label: "Mild", maxScore: 19, class: "level-mild" }, { label: "Moderate", maxScore: 28, class: "level-borderline" }, { label: "Severe", maxScore: 63, class: "level-severe" }
        ];

        // --- DOM Elements ---
        const introView = document.getElementById('introView');
        const questionsView = document.getElementById('questionsView');
        const resultsView = document.getElementById('resultsView');
        const questionContent = document.getElementById('questionContent');
        const validationMessage = document.getElementById('validationMessage');
        const startButton = document.getElementById('startButton');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const restartButton = document.getElementById('restartButton');
        const backToQuestionsBtn = document.getElementById('backToQuestions');
        const scoreValueEl = document.getElementById('scoreValue');
        const scoreInterpretationEl = document.getElementById('scoreInterpretation');
        const scoreLevelsEl = document.getElementById('scoreLevels');
        const yourScoreMarkerContainerEl = document.getElementById('yourScoreMarkerContainer');
        const yourScoreTextEl = document.getElementById('yourScoreText');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const progressBarFill = document.getElementById('progressBarFill');
        const questionCounterEl = document.getElementById('questionCounter');
        const interpretationTableBodyEl = document.getElementById('interpretationTableBody');
        const generateImageBtn = document.getElementById('generateImageBtn');
        const toastNotification = document.getElementById('toastNotification');
        const imageModal = document.getElementById('imageModal');
        const modalClose = document.getElementById('modalClose');
        const resultImage = document.getElementById('resultImage');
        const downloadImageBtn = document.getElementById('downloadImageBtn');
        const shareImageBtn = document.getElementById('shareImageBtn');
        const resultsCapture = document.getElementById('resultsCapture');
        const captureScoreValue = document.getElementById('captureScoreValue');
        const captureInterpretation = document.getElementById('captureInterpretation');
        const captureScoreLevels = document.getElementById('captureScoreLevels');
        const captureScoreMarker = document.getElementById('captureScoreMarker');
        const captureScoreText = document.getElementById('captureScoreText');
        const captureDate = document.getElementById('captureDate');

        // --- State Variables ---
        let currentQuestionIndex = 0;
        let answers = new Array(questions.length).fill(null);
        let autoAdvanceTimeout = null;
        let resultImageUrl = null;
        let totalScore = 0;
        let resultInterpretation = null;

        // --- Functions ---
        function switchView(viewName) {
            introView.classList.add('hidden-view');
            questionsView.classList.add('hidden-view');
            resultsView.classList.add('hidden-view');
            
            if (viewName === 'intro') {
                introView.classList.remove('hidden-view');
                progressBarContainer.classList.add('hidden-view');
                questionCounterEl.classList.add('hidden-view');
            } else if (viewName === 'questions') {
                questionsView.classList.remove('hidden-view');
                progressBarContainer.classList.remove('hidden-view');
                questionCounterEl.classList.remove('hidden-view');
                renderCurrentQuestion();
                updateProgressBar();
            } else if (viewName === 'results') {
                resultsView.classList.remove('hidden-view');
                progressBarContainer.classList.remove('hidden-view');
                questionCounterEl.classList.add('hidden-view');
                calculateAndShowResults();
            }
        }

        function renderCurrentQuestion() {
            const question = questions[currentQuestionIndex];
            questionContent.innerHTML = '';
            
            // Add the symptom category heading
            const categoryEl = document.createElement('div');
            categoryEl.className = 'symptom-category';
            categoryEl.innerHTML = `Q${question.id}. Symptom category: <span class="category-name">${question.category}</span> <span style="font-size:0.85em;color:#666;margin-left:8px;">${question.category_bn || ''}</span>`;
            questionContent.appendChild(categoryEl);
            
            // Add instruction subheading
            const instructionEl = document.createElement('p');
            instructionEl.className = 'question-instruction';
            instructionEl.textContent = "Carefully choose the one statement that best describes how you have been feeling during the past two weeks, including today.";
            questionContent.appendChild(instructionEl);
            
            const form = document.createElement('form');
            form.id = `question-${question.id}-form`;
            
            question.statements.forEach((statement, idx) => {
                const label = document.createElement('label');
                label.className = 'statement-label';
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `question-${question.id}`;
                radio.value = statement.score;
                radio.checked = answers[currentQuestionIndex] === statement.score;
                radio.addEventListener('change', () => {
                    answers[currentQuestionIndex] = statement.score;
                    updateProgressBar();
                    clearTimeout(autoAdvanceTimeout);
                    autoAdvanceTimeout = setTimeout(() => handleNext(true), 800); // Auto-advance after selection
                });
                
                label.appendChild(radio);
                label.appendChild(document.createTextNode(statement.text));
                form.appendChild(label);
            });
            
            questionContent.appendChild(form);
            updateQuestionCounter();
            
            // Update button states
            prevButton.disabled = currentQuestionIndex === 0;
            nextButton.textContent = currentQuestionIndex === questions.length - 1 ? 'See Results' : 'Next';
            nextButton.innerHTML = currentQuestionIndex === questions.length - 1 ? 'See Results <i class="fas fa-chart-bar"></i>' : 'Next <i class="fas fa-chevron-right"></i>';
        }

        function updateQuestionCounter() {
            questionCounterEl.textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
        }

        function handleNext(isAutoAdvance = false) {
            // If this is the last question and user hasn't answered, show validation message
            if (currentQuestionIndex === questions.length - 1 && answers[currentQuestionIndex] === null) {
                validationMessage.textContent = 'Please select an answer before continuing.';
                validationMessage.classList.remove('hidden-view');
                return;
            }
            
            // If user hasn't answered current question and this is not auto-advance, show validation
            if (answers[currentQuestionIndex] === null && !isAutoAdvance) {
                validationMessage.textContent = 'Please select an answer before continuing.';
                validationMessage.classList.remove('hidden-view');
                return;
            }
            
            validationMessage.classList.add('hidden-view');
            
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                renderCurrentQuestion();
            } else {
                switchView('results');
            }
        }

        function handlePrev() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderCurrentQuestion();
                validationMessage.classList.add('hidden-view');
            }
        }

        function getInterpretationByScore(score) {
            for (const item of scoreInterpretations) {
                if (score >= item.range[0] && score <= item.range[1]) {
                    return item;
                }
            }
            return { label: "N/A", interpretation: "Score out of range.", class: "" };
        }

        function populateInterpretationTable() {
            interpretationTableBodyEl.innerHTML = ''; // Clear existing rows
            const levelColors = [
                'background-color: rgba(0, 190, 97, 0.15)', // Minimal - green
                'background-color: rgba(76, 154, 255, 0.15)', // Mild - blue
                'background-color: rgba(255, 170, 66, 0.15)', // Borderline - orange
                'background-color: rgba(255, 94, 109, 0.15)'  // Severe - red
            ];
            
            scoreInterpretations.forEach((item, index) => {
                const row = interpretationTableBodyEl.insertRow();
                row.style = levelColors[index];
                const cellScore = row.insertCell();
                const cellLevel = row.insertCell();
                cellScore.textContent = `${item.range[0]} - ${item.range[1]}`;
                cellLevel.textContent = item.label; // Using label which includes "depression"
            });
        }

        function createColumnChart(score, maxScore) {
            const columnChartEl = document.getElementById('columnChart');
            columnChartEl.innerHTML = '';
            const segments = [
                { label: 'Minimal', maxScore: 13, color: '#00be61', range: '0-13', height: 80 },
                { label: 'Mild', maxScore: 19, color: '#4c9aff', range: '14-19', height: 110 },
                { label: 'Moderate', maxScore: 28, color: '#ffaa42', range: '20-28', height: 140 },
                { label: 'Severe', maxScore: 63, color: '#ff5e6d', range: '29-63', height: 170 }
            ];
            segments.forEach(segment => {
                // Bar container
                const barContainer = document.createElement('div');
                barContainer.style.display = 'flex';
                barContainer.style.flexDirection = 'column';
                barContainer.style.alignItems = 'center';
                barContainer.style.width = '22%';
                barContainer.style.margin = '0 1%';
                // Range label above
                const rangeLabel = document.createElement('div');
                rangeLabel.style.marginBottom = '6px';
                rangeLabel.style.fontWeight = '500';
                rangeLabel.style.fontSize = '1rem';
                rangeLabel.style.color = '#222';
                rangeLabel.textContent = segment.range;
                barContainer.appendChild(rangeLabel);
                // Bar itself
                const bar = document.createElement('div');
                bar.style.height = segment.height + 'px';
                bar.style.width = '100%';
                bar.style.backgroundColor = segment.color;
                bar.style.borderRadius = '4px 4px 0 0';
                bar.style.marginBottom = '8px';
                barContainer.appendChild(bar);
                // Label below
                const label = document.createElement('div');
                label.style.marginTop = '2px';
                label.style.fontWeight = '400';
                label.style.fontSize = '1rem';
                label.style.color = '#222';
                label.textContent = segment.label;
                barContainer.appendChild(label);
                columnChartEl.appendChild(barContainer);
            });
            // Make the chart flex
            columnChartEl.style.display = 'flex';
            columnChartEl.style.alignItems = 'flex-end';
            columnChartEl.style.justifyContent = 'space-around';
            columnChartEl.style.height = '200px';
            columnChartEl.style.margin = '0 10px';
            columnChartEl.style.position = 'relative';
        }

        function calculateAndShowResults() {
            totalScore = answers.reduce((sum, val) => sum + (val !== null ? val : 0), 0);
            const maxPossibleScore = 63; // BDI-II max score

            scoreValueEl.textContent = `Your Score: ${totalScore} out of ${maxPossibleScore}`;
            
            resultInterpretation = getInterpretationByScore(totalScore);
            scoreInterpretationEl.textContent = resultInterpretation.interpretation;
            
            // Set color of interpretation text based on severity
            if (totalScore <= 13) {
                scoreInterpretationEl.style.color = '#00be61'; // Minimal
            } else if (totalScore <= 19) {
                scoreInterpretationEl.style.color = '#4c9aff'; // Mild
            } else if (totalScore <= 28) {
                scoreInterpretationEl.style.color = '#ffaa42'; // Borderline
            } else {
                scoreInterpretationEl.style.color = '#ff5e6d'; // Severe
            }

            // Create column chart instead of modern chart
            createColumnChart(totalScore, maxPossibleScore);

            populateInterpretationTable(); // Populate the table
            updateProgressBar(true);
        }

        function updateProgressBar(completed = false) {
            let percentage;
            if (completed) {
                percentage = 100;
            } else {
                percentage = ((currentQuestionIndex) / questions.length) * 100;
                if (answers[currentQuestionIndex] !== null) { // If current question is answered, count it fully
                    percentage = ((currentQuestionIndex + 1) / questions.length) * 100;
                }
            }
            progressBarFill.style.width = `${percentage}%`;
            progressBarFill.textContent = `${Math.round(percentage)}%`;
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            answers = new Array(questions.length).fill(null);
            validationMessage.classList.add('hidden-view');
            clearTimeout(autoAdvanceTimeout);
            switchView('intro');
        }
        
        // Updated capture preparation with column chart
        function prepareResultsCapture() {
            const segments = [
                { label: 'Minimal', maxScore: 13, color: '#00be61', range: "0-13" },
                { label: 'Mild', maxScore: 19, color: '#4c9aff', range: "14-19" },
                { label: 'Moderate', maxScore: 28, color: '#ffaa42', range: "20-28" },
                { label: 'Severe', maxScore: 63, color: '#ff5e6d', range: "29-63" }
            ];
            captureScoreValue.textContent = `Your Score: ${totalScore} out of 63`;
            captureInterpretation.textContent = resultInterpretation.interpretation;
            captureInterpretation.style.backgroundColor = '#d1fae5';
            captureInterpretation.style.color = '#059669';
            const now = new Date();
            captureDate.textContent = now.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            // Render the chart inside #captureScoreLevels
            const captureScoreLevels = document.getElementById('captureScoreLevels');
            captureScoreLevels.innerHTML = '';
            const columnChart = document.createElement('div');
            columnChart.className = 'column-chart';
            columnChart.style.height = '200px';
            columnChart.style.margin = '0 10px';
            columnChart.style.display = 'flex';
            columnChart.style.alignItems = 'flex-end';
            columnChart.style.justifyContent = 'space-around';
            segments.forEach(segment => {
                const barContainer = document.createElement('div');
                barContainer.style.display = 'flex';
                barContainer.style.flexDirection = 'column';
                barContainer.style.alignItems = 'center';
                barContainer.style.width = '22%';
                barContainer.style.margin = '0 1%';
                // Range label above
                const rangeLabel = document.createElement('div');
                rangeLabel.style.marginBottom = '6px';
                rangeLabel.style.fontWeight = '500';
                rangeLabel.style.fontSize = '1rem';
                rangeLabel.style.color = '#222';
                rangeLabel.textContent = segment.range;
                barContainer.appendChild(rangeLabel);
                // Bar itself
                const bar = document.createElement('div');
                bar.style.height = (segment.maxScore / 63 * 170 + 30) + 'px';
                bar.style.width = '100%';
                bar.style.backgroundColor = segment.color;
                bar.style.borderRadius = '4px 4px 0 0';
                bar.style.marginBottom = '8px';
                barContainer.appendChild(bar);
                // Label below
                const label = document.createElement('div');
                label.style.marginTop = '2px';
                label.style.fontWeight = '400';
                label.style.fontSize = '1rem';
                label.style.color = '#222';
                label.textContent = segment.label;
                barContainer.appendChild(label);
                columnChart.appendChild(barContainer);
            });
            captureScoreLevels.appendChild(columnChart);
        }

        // Function to generate image from results - fixed for download
        async function generateResultImage() {
            generateImageBtn.innerHTML = '<span class="loading-spinner"></span> Creating...';
            generateImageBtn.disabled = true;
            try {
                prepareResultsCapture();
                resultsCapture.style.position = 'absolute';
                resultsCapture.style.top = '-9999px';
                resultsCapture.style.left = '-9999px';
                resultsCapture.classList.remove('hidden-view');
                await new Promise(resolve => requestAnimationFrame(resolve));
                await new Promise(resolve => setTimeout(resolve, 100));
                const canvas = await html2canvas(resultsCapture, {
                    scale: 3,
                    backgroundColor: 'white',
                    logging: false,
                    useCORS: true
                });
                resultImageUrl = canvas.toDataURL('image/jpeg', 0.95);
                resultsCapture.classList.add('hidden-view');
                resultsCapture.style.position = '';
                resultsCapture.style.top = '';
                resultsCapture.style.left = '';
                const link = document.createElement('a');
                link.href = resultImageUrl;
                link.download = `BDI-II_Results_${new Date().toISOString().split('T')[0]}.jpg`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showToast('Results downloaded successfully!');
                generateImageBtn.innerHTML = '<i class="fas fa-download"></i> Download Result';
                generateImageBtn.disabled = false;
            } catch (error) {
                console.error('Error generating image:', error);
                showToast('Failed to generate image. Please try again.');
                generateImageBtn.innerHTML = '<i class="fas fa-download"></i> Download Result';
                generateImageBtn.disabled = false;
            }
        }

        // Function to copy test link to clipboard
        function copyTestLink() {
            const testUrl = window.location.href || 'https://example.com/bdi-assessment';
            
            navigator.clipboard.writeText(testUrl)
                .then(() => {
                    showToast('Test link copied to clipboard!');
                })
                .catch(err => {
                    console.error('Failed to copy: ', err);
                    showToast('Failed to copy link. Try again.');
                });
        }

        // Updated event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for the new copy link button
            document.getElementById('copyLinkBtn').addEventListener('click', copyTestLink);
            
            // Fix the download button
            document.getElementById('generateImageBtn').addEventListener('click', generateResultImage);
        });

        // Event listeners
        startButton.addEventListener('click', () => switchView('questions'));
        nextButton.addEventListener('click', () => handleNext(false));
        prevButton.addEventListener('click', handlePrev);
        restartButton.addEventListener('click', restartQuiz);
        backToQuestionsBtn.addEventListener('click', () => {
            switchView('questions');
        });

        // Add event listener for the copy link button
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        if (copyLinkBtn) {
            copyLinkBtn.addEventListener('click', copyTestLink);
        }

    </script>

</body>
</html>
